<!DOCTYPE html>
<html lang="en" ng-app="silScriptApp">
{% load staticfiles %}
<head>
    <meta charset="UTF-8">
    <title></title>
    <link href="{% static 'marketing/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'marketing/sweetalert.css' %}" rel="stylesheet">
    <style>
        .row3 {margin-bottom: 10px}
        .btn1 {width: 80px;}
        .input-group-addon {
            font-weight: bold;
        }
    </style>
    <script src="{% static 'marketing/jquery-2.1.4.min.js' %}"></script>
    <script src="{% static 'marketing/bootstrap/js/bootstrap.min.js' %}"></script>

    <script src="{% static 'marketing/angular.min.js' %}"></script>
    <script src="{% static 'marketing/angular-resource.min.js' %}"></script>
    <script src="{% static 'marketing/sweetalert.min.js' %}"></script>

    <script>
        var apiPath = '/crm/api/v1';

        var resourceGenerator = function(path, parameter, isArray) {
            isArray = isArray || false;
            return function($resource) {
                return $resource(path, parameter,
                        {
                            'update': { method:'PUT' },
                            'patch' : { method: 'PATCH' },
                            'query': {method:'GET', isArray: isArray}
                        });
            }
        };

        angular.module("silScriptApp",['ngResource'])

        .config(function($interpolateProvider, $resourceProvider, $httpProvider) {
            $interpolateProvider.startSymbol('{[{');
            $interpolateProvider.endSymbol('}]}');
            $resourceProvider.defaults.stripTrailingSlashes = false;

            $httpProvider.defaults.xsrfCookieName = 'csrftoken';
            $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
        })

        .factory('Customers', ['$resource', resourceGenerator(apiPath + '/marketing/customers/:customerId/', {customerId:'@id'})])

        .factory('Leads', ['$resource', resourceGenerator(apiPath + '/marketing/leads/:leadId/', {leadId:'@id'})])

        .factory('Plans', ['$resource', resourceGenerator(apiPath + '/sales/plans/:planId/', {planId:'@id'})])

        .factory('Opportunities', ['$resource', resourceGenerator(apiPath + '/sales/opportunities/:opportunityId/', {opportunityId:'@id'})])

        .directive("dob", function() {
            return {
                restrict: "A",
                require: "ngModel",
                link: function(scope, element, attributes, ngModel) {
                    ngModel.$validators.dob = function(modelValue) {
                        var re = /^(0?[1-9]|1[0-2])\/(0?[1-9]|1\d|2\d|3[01])\/(19|20)\d{2}$/,
                            result = re.test(modelValue) || modelValue == '';

                        if (result && modelValue != ''){
                            var dateParts = modelValue.split('/'),
                                pMonth = dateParts[0],
                                pDay = dateParts[1],
                                pYear = dateParts[2],
                                maxDays = new Date(pYear, pMonth, 0).getDate();

                            result = (parseInt(pDay,10) <= maxDays);
                        }

                        return result;

                    }
                }
            };
        })

        .directive("time", function() {
            return {
                restrict: "A",
                require: "ngModel",
                link: function(scope, element, attributes, ngModel) {
                    ngModel.$validators.time = function(modelValue) {
                        var re = /^(0?[1-9]|1[012])(:[0-5]\d) [APap][mM]$/,
                            result = re.test(modelValue) || modelValue == '';

                        if (result && modelValue != ''){
                            var timeParts = modelValue.split(':'),
                                ap = timeParts[1].split(' ')[1],
                                tHour = parseInt(timeParts[0],10);

                            result = (ap.toLowerCase() === 'am' && tHour > 7) || (ap.toLowerCase() === 'pm');
                        }

                        return result;
                    }
                }
            };
        })

        .controller("LeadInstanceCtrl", function ($scope, $filter,  Leads, Plans, Opportunities, Customers){

            $scope.carriers = [
                {id: "Unitedhealth", name: 'Unitedhealth'},
                {id: "GoldenRule", name: 'GoldenRule'},
                {id: "Wellpoint", name: 'Wellpoint'},
                {id: "Kaiser", name: 'Kaiser'},
                {id: "Humana", name: 'Humana'},
                {id: "Aetna", name: 'Aetna'},
                {id: "Cigna", name: 'Cigna'},
                {id: "Coventry", name: 'Coventry'},
                {id: "BlueCross", name: 'BlueCross'},
                {id: "BlueShield", name: 'BlueShield'},
                {id: "Health Net", name: 'Health Net'},
                {id: "Other", name: 'Other'}
            ];
            $scope.showCarriers = false;

            $scope.lead = {
                external_id: "{{ lead_id }}",
                vicidial_list_id: {{ list_id }},
                vici_user_name: "{{ agent }}",
                plan_size: "",
                first_name: "{{ first_name }}",
                middle_initial: "{{ middle_initial }}",
                last_name: "{{ last_name }}",
                dob: new Date("{{ date_of_birth }}"),
                address: "{{ address1 }}",
                city: "{{ city }}",
                state: "{{ state }}",
                zipcode: "{{ postal_code }}",
                phone: "{{ phone_number }}",
                primary_email: "{{ email }}",
                height_feet: 0,
                height_inches: 0,
                weight: 0,
                budget: 0,
                income: 0,
                conditions: "",
                currently_insured: "{{ currently_insured }}",
                more_than_63days_uninsured: {{ more_than_63days_uninsured }},
                med_ty: "{{ med_ty }}",
                dr_vis: {{ dr_vis }},
                smoker: "{{ smoker }}",
                de_in: {{ de_in }},
                ins_asp: "{{ ins_asp }}",
                al_dr: "{{ al_dr }}",
                alz: "{{ alz }}",
                art_d: "{{ art_d }}",
                bon_d: "{{ bon_d }}",
                emphy: "{{ emphy }}",
                fibro: "{{ fibro }}",
                bip: "{{ bip }}",
                acc_cer: "{{ acc_cer }}",
                obs_lung: "{{ obs_lung }}",
                obs_pul: "{{ obs_pul }}",
                crohn_d: "{{ crohn_d }}",
                hepp: "{{ hepp }}",
                heart_att: "{{ heart_att }}",
                ins_dep: "{{ ins_dep }}",
                int_ca: "{{ int_ca }}",
                kidn_d: "{{ kidn_d }}",
                liv_d: "{{ liv_d }}",
                lou_d: "{{ lou_d }}",
                lupus: "{{ lupus }}",
                depress: "{{ depress }}",
                melo_ca: "{{ melo_ca }}",
                sclero: "{{ sclero }}",
                muscle_d: "{{ muscle_d }}",
                muscle_dy: "{{ muscle_dy }}",
                myosi: "{{ myosi }}",
                organ_f: "{{ organ_f }}",
                orga_t: "{{ orga_t }}",
                brain_s: "{{ brain_s }}",
                osteop: "{{ osteop }}",
                paraly: "{{ paraly }}",
                isc_att: "{{ isc_att }}",
                peri_va: "{{ peri_va }}",
                rheu_ar: "{{ rheu_ar }}",
                seni_d: "{{ seni_d }}",
                stroke: "{{ stroke }}",
                sub_ad: "{{ sub_ad }}",
                ulc: "{{ ulc }}",
                nu_med: {{ nu_med }},
                gender: "{{ gender }}",
                carrier: ""
            };

            $scope.customer = 0;
            $scope.customers = [];
            initCustomers();

            function initCustomers(){
                {%  for cust in customers %}
                    $scope.customers.push({
                        id: {{ cust.customer.id }},
                        code: '{{ cust.customer.code }}'
                    });

                {%  endfor %}
            }

            $scope.submitted = false;
            $scope.isDebug = false;
            $scope.sendEmail = 0;
            $scope.btn_action = 'none';
            var lead_state = '{{ state }}';

            $scope.stateIsValid = function(st){
                return states_codes.indexOf(st) > -1
            };

            Plans.query({limit: 100}, function(r){
                var results = r.results;
                $scope.planOptions = results;

                function fillPlanOpts(results){
                    var obj = {};

                    results.forEach(function(item){
                        obj[item.id] = item.description;
                    });
                    $scope.planOpts = obj;
                    $scope.setPlanName = function(plId){
                        $scope.lead.plan_size = plId;
                        $scope.planName = $scope.planOpts[plId] || "";
                    };
                    $scope.setPlanName($scope.lead.plan_size);
                }

                fillPlanOpts(results);
            });

            $scope.leadDOB = function(){
                var dob = '{{ date_of_birth }}';

                return (dob == '' || dob == 'Invalid Date' || new Date(dob) == 'Invalid Date') ? '' : $filter('date')(dob, 'MM/dd/yyyy', 'EDT');
            };

            $scope.autoLead = function(){
                var dt = '{{ date_to_call }}';

                return (dt == '' || dt == 'Invalid Date' || new Date(dt) == 'Invalid Date') ? '' : $filter('date')(dt, 'MM/dd/yyyy', 'EDT');
            };

            function dateStringToDjango(dateValue) {
                var day = dateValue.toISOString();

                return day.split('T')[0];
            }

            $scope.setCustomer = function(customer){
                $scope.customer = customer;
            }

            $scope.getCustomers = function(){


                function addCustomer(element, index, array){
                    $scope.customers.push({
                        id: element.id,
                        code: element.code
                    });
                }

                Customers.query({list_id: {{ list_id }}, state: $scope.lead.state}, function(result){
                   $scope.customers = [];
                   $scope.customer = 0;
                   result.results.forEach(addCustomer);
                });

            }

            $scope.selLeadDOB = $scope.leadDOB();
            $scope.selectLeadCallDate = $scope.autoLead();
            $scope.selAutoInsurance = false;
            $scope.selectLeadCallDate = '';
            $scope.selectLeadCallTime = '';

            function genValidLead(lead) {
                var valid_lead = angular.copy(lead);

                if (valid_lead.plan_size === "") {
                    delete valid_lead.plan_size;
                }

                if ($scope.selLeadDOB == '') {
                    delete valid_lead.dob;
                } else {
                    valid_lead.dob = dateStringToDjango(new Date($scope.selLeadDOB));
                }

                if ($scope.selAutoInsurance && $scope.selectLeadCallDate !== '') {
                    valid_lead.auto_insurance = 'True';
                    var callDateTime = new Date($scope.selectLeadCallDate + ' ' + $scope.selectLeadCallTime);
                    callDateTime.setHours(callDateTime.getHours()-(parseInt(callDateTime.getTimezoneOffset()/60, 10)));
                    valid_lead.auto_insurance_date_to_be_call = callDateTime.toISOString();
                } else {
                    delete valid_lead.auto_insurance;
                    delete valid_lead.auto_insurance_date_to_be_call;
                }

                if ($scope.sendEmail == 1) {
                    valid_lead.send_email = 1;
                }

                $scope.sendEmail = 0;

                return valid_lead;
            }

            function saveLeadToUnicorn(callback){
                var validLead = genValidLead($scope.lead),
                    lead = new Leads(validLead);

                function dealWithError(error){
                    var errors = error.data;

                    console.log(errors);
                    swal("Saving failed!", JSON.stringify(errors), "warning");
                }

                lead.$save().then(callback, dealWithError);
            }

            $scope.submitLead = function() {
                $scope.btn_action = 'posting';
                swal(
                    {
                        title: "Please, confirm submission",
                        text: "Changes will no be possible after this operation!",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "Confirm",
                        closeOnConfirm: false,
                        showLoaderOnConfirm: true
                    },
                    function(){
                        var cb = function(result){
                            var opp = {lead_id: result.id, customer: $scope.customer},
                                opportunity = new Opportunities(opp);

                            $scope.submitted = true;
                            opportunity.$save().then(
                                function(){
                                    swal({ title: "Information submitted!", text: "Operation successful!", type: "success", timer: 1000, showConfirmButton: false });
                                    $scope.setInfo = 4;
                                },
                                function(error){
                                    $scope.submitted = false;
                                    console.log(error.data);
                                    swal(
                                        {
                                            title: "Submission failed!",
                                            text: JSON.stringify(error.data),
                                            type: "error",
                                            showCancelButton: false,
                                            confirmButtonColor: "#DD6B55",
                                            confirmButtonText: "Ok",
                                            closeOnConfirm: true
                                        }
                                    );
                                    $scope.btn_action = 'none';
                                }
                            );
                        };
                        saveLeadToUnicorn(cb);
                    }
                );
                $scope.btn_action = 'none';

            };

            $scope.saveLead = function () {
                $scope.btn_action = 'posting';
                var cb = function(){
                    swal({ title: "Information saved!", text: "", type: "success", timer: 1000, showConfirmButton: false });
                    $scope.btn_action = 'none';
                };

                saveLeadToUnicorn(cb);
            };

            $scope.emailData = function(){
                $scope.btn_action = 'posting';
                var cb = function(){
                    swal({ title: "Information emailed!", text: "", type: "success", timer: 1000, showConfirmButton: false });
                    $scope.btn_action = 'none';
                };

                $scope.sendEmail = 1;
                saveLeadToUnicorn(cb);
            };

            $scope.setInfo = 1;

            $scope.phoneNumberPattern = (function() {
                var regexp = /^\(?(\d{3})\)?[ .-]?(\d{3})[ .-]?(\d{4})$/;
                return {
                    test: function(value) {
                        if( $scope.requireTel === false ) {
                            return true;
                        }
                        return regexp.test(value);
                    }
                };
            })();

            $scope.validateWeight = function(){
                var lweight = $scope.lead.weight;

                lweight = lweight ? parseInt(lweight, 10) : 0;
                $scope.lead.weight = lweight;
            };

            $scope.returnInteger = function(param){
                param = param ? parseInt(param, 10) : 0;
                return param;
            };

{#            function setSelDob(datePart, dateArr) {#}
{#                return dateArr.filter(function(i) { return i.id == datePart })[0];#}
{#            }#}

            $scope.daysInMonth = function(month,year) {
                return new Date(year, month, 0).getDate();
            };

            $scope.reloadData = function(){
                window.location.reload(true);
            };

        }
    );

    </script>
</head>
<body>
<div class="panel panel-default">
    <div class="panel-body" ng-controller="LeadInstanceCtrl">

        <div class="container" ng-hide="setInfo == 4">
            <p class="lead text-center bg-primary"><strong>Lead information</strong></p>
            <div class="row">
                <div class="col-xs-12">
                    {% csrf_token %}
                    <ul class="nav nav-tabs">
                        <li role="presentation" ng-class="{ active : setInfo == 1 }"><a href="#" ng-click="setInfo = 1">1. Lead Information</a></li>
                        <li role="presentation" ng-class="{ active : setInfo == 2 }"><a href="#" ng-click="setInfo = 2">2. Conditions</a></li>
                        <li role="presentation" ng-class="{ active : setInfo == 3 }"><a href="#" ng-click="setInfo = 3">3. Pre-existing Conditions</a></li>
                    </ul>
                    <div class="row row3"></div>

                    <div class="row" ng-show="setInfo == 1">
                        <form name="leadBasicForm" novalidate>
                            <div class="row row3">
                                <div class="col-xs-4">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">Plan</span>
                                        <select class="form-control" ng-model="lead.plan_size">
                                            <option ng-repeat="plo in planOptions" value="{[{ plo.id }]}">{[{plo.description}]}</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-xs-4">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">Budget (m)</span>
                                        <input type="number" step="1" max=10000 oninput="this.value = this.value.replace(/[.]/g,'');" name="budget" class="form-control" ng-model="lead.budget" pattern="^[0-9]*$">
                                    </div>
                                    <p class="error alert-danger" ng-hide="leadBasicForm.budget.$valid">Limit exceeded. Max value: 10000</p>
                                </div>
                                <div class="col-xs-4">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">Income (y)</span>
                                        <input type="number" max=200000 oninput="this.value = this.value.replace(/[.]/g,'');" name="income" class="form-control" ng-model="lead.income">
                                    </div>
                                    <p class="error alert-danger" ng-hide="leadBasicForm.income.$valid">Limit exceeded. Max value: 200000</p>
                                </div>
                            </div>
                            <div class="row row3">
                                <div class="col-xs-4">
                                    <div class="input-group">
                                        <span class="input-group-addon">First N.</span>
                                        <input type="text" class="form-control" name="firstname" maxlength="100" ng-model="lead.first_name" value="{{ first_name }}">
                                    </div>
                                    <p class="error alert-danger" ng-hide="leadBasicForm.firstname.$valid">100 characters max!</p>
                                </div>
                                <div class="col-xs-3">
                                    <div class="input-group">
                                        <span class="input-group-addon">MI</span>
                                        <input type="text" class="form-control" maxlength="1" ng-model="lead.middle_initial" value="{{ middle_initial }}">
                                    </div>
                                </div>
                                <div class="col-xs-5">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">Last N.</span>
                                        <input type="text" class="form-control" name="lastname" maxlength="100" ng-model="lead.last_name" value="{{ last_name }}">
                                    </div>
                                    <p class="error alert-danger" ng-hide="leadBasicForm.lastname.$valid">100 characters max!</p>
                                </div>
                            </div>
                            <div class="row row3">
                                <div class="col-xs-5">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">Phone</span>
                                        <input type="text" name="phone" min=10 max=10 class="form-control" ng-model="lead.phone" value="{{ phone_number }}" ng-required="requireTel" ng-pattern="phoneNumberPattern" >
                                    </div>
                                    <p class="error alert-danger" ng-hide="leadBasicForm.phone.$valid">Please, enter 10 digit number</p>
                                </div>
                                <div class="col-xs-7">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">Email</span>
                                        <input type="text" name="email" maxlength="100" class="form-control" ng-model="lead.primary_email" value="{{ email }}">
                                    </div>
                                    <p class="error alert-danger" ng-hide="leadBasicForm.email.$valid">Please, enter valid email (100 characters max)</p>
                                </div>
                            </div>
                            <div class="row row3">
                                <div class="col-xs-12">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">Address</span>
                                        <input type="text" class="form-control" maxlength="200" name="address" ng-model="lead.address"  value="{{ address1 }}">
                                    </div>
                                    <p class="error alert-danger" ng-hide="leadBasicForm.address.$valid">200 characters max!</p>
                                </div>
                            </div>
                            <div class="row row3">
                                <div class="col-xs-4">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">City</span>
                                        <input type="text" class="form-control" maxlength="50" name="city" ng-model="lead.city" value="{{ city }}">
                                    </div>
                                    <p class="error alert-danger" ng-hide="leadBasicForm.city.$valid">50 characters max!</p>
                                </div>
                                <div class="col-xs-4">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">State</span>
                                        <select class="form-control" ng-model="lead.state" ng-change="getCustomers()" value="{{ state }}" name="l_state" required ng-pattern="/^(A[LKSZRAEP]|C[AOT]|D[EC]|F[LM]|G[ANU]|HI|I[ADLN]|K[SY]|LA|M[ADEHINOPST]|N[CDEHJMVY]|O[HKR]|P[ARW]|RI|S[CD]|T[NX]|UT|V[AIT]|W[AIVY])$/">
                                            {% for st in state_choices %}
                                                <option value="{{ st.0 }}">{{st.1}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <p class="error alert-danger" ng-hide="leadBasicForm.l_state.$valid">Invalid State Code!</p>
                                </div>
                                <div class="col-xs-4">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">Zip Code</span>
                                        <input type="text" minlength="5" maxlength="5" class="form-control" ng-pattern="/^\d+$/" name="zipcode" name="zip" ng-model="lead.zipcode" value="{{ postal_code }}" >
                                    </div>
                                    <p class="error alert-danger" ng-hide="leadBasicForm.zipcode.$valid">Invalid Zip Code</p>
                                </div>
                            </div>
                            <div class="row row3">
                                <div class="col-xs-4">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">Height (ft)</span>
                                        <select class="form-control" ng-model="lead.height_feet">
                                            <option ng-repeat="heightFt in [{id: 3}, {id: 4}, {id: 5}, {id: 6}, {id: 7}]">{[{heightFt.id}]}</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-xs-4">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">Height (in)</span>
                                        <select class="form-control" ng-model="lead.height_inches">
                                            <option ng-repeat="heightIn in [{id: 0}, {id: 1}, {id: 2}, {id: 3}, {id: 4}, {id: 5}, {id: 6}, {id: 7}, {id: 8}, {id: 9}, {id: 10}, {id: 11}]">{[{heightIn.id}]}</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-xs-4">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">Weight (lb)</span>
                                        <input type="number" name="lweight" oninput="this.value = this.value.replace(/[.]/g,'');"  class="form-control" ng-model="lead.weight">
                                    </div>
                                    <p class="error alert-danger" ng-show="leadBasicForm.lweight.$invalid">Invalid value!</p>
                                </div>
                            </div>
                            <div class="row row3">
                                <div class="col-xs-12">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">Date Of Birth (DOB)</span>
                                        <input type="text" class="form-control" maxlength="10" name="selectDob" ng-model="selLeadDOB" placeholder="MM/DD/YYYY" dob>
                                    </div>
                                    <p class="error alert-danger" ng-show="leadBasicForm.selectDob.$error.dob">Please, enter valid date (format: MM/DD/YYYY). Example: 02/09/1987</p>
                                </div>
                            </div>
                            <div class="row row3">
                                <div class="col-xs-12">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">Conditions</span>
                                        <input type="text"  class="form-control" ng-model="lead.conditions">
                                    </div>
                                </div>
                            </div>
                            <div class="row row3">
                                <div class="col-xs-12">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">Number of Medications</span>
                                        <select class="form-control" ng-model="lead.nu_med">
                                            <option ng-repeat="numed in [{id: 0},{id: 1},{id: 2},{id: 3},{id: 4}]">{[{numed.id}]}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row row3">
                                <div class="col-xs-4">
                                    <div class="input-group m-b">
                                        <span class="input-group-addon">
                                            <input type="checkbox" ng-model="selAutoInsurance">
                                        </span>
                                        <p class="form-control">Interested in auto insurance quote?</p>
                                    </div>
                                </div>
                                <div class="col-xs-4">
                                    <div class="input-group m-b" ng-show="selAutoInsurance">
                                        <span class="input-group-addon">Date to be called</span>
                                        <input type="text" class="form-control" maxlength="10" name="selectCallDate" ng-model="selectLeadCallDate" placeholder="MM/DD/YYYY ( *required )" dob ng-required="selAutoInsurance">
                                        <p class="error alert-danger" ng-show="leadBasicForm.selectCallDate.$error.dob">Required with valid date format (MM/DD/YYYY). Example: 02/09/1987</p>
                                    </div>
                                </div>
                                <div class="col-xs-4">
                                    <div class="input-group m-b" ng-show="selAutoInsurance">
                                        <span class="input-group-addon">Time to be called</span>
                                        <input type="text" class="form-control" name="selectCallTime" ng-model="selectLeadCallTime" time placeholder="HH:MM am/pm">
                                        <p class="error alert-danger" ng-show="leadBasicForm.selectCallTime.$error.time">Valid time format (HH:MM am/pm). From 8:00 am. Example: 4:50 pm</p>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="row" ng-show="setInfo == 2">
                        <div class="row row3">
                            <div class="col-xs-12">
                                <div class="input-group m-b">
                                    <span class="input-group-addon">
                                        <input type="checkbox" ng-model="lead.currently_insured">
                                    </span>
                                    <p class="form-control">Currently insured</p>
                                </div>
                            </div>
                        </div>
                        <div class="row row3" ng-show="lead.currently_insured">
                            <div class="col-xs-12">
                                <div class="input-group m-b">
                                    <span class="input-group-addon">Carrier</span>
                                    <select class="form-control" ng-model="lead.carrier" >
                                        <option ng-repeat="carrier in carriers" >{[{carrier.name}]}</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row row3">
                            <div class="col-xs-12">
                                <div class="input-group m-b">
                                    <span class="input-group-addon"><input type="checkbox" ng-model="lead.more_than_63days_uninsured"></span>
                                    <p class="form-control">If NO / Have you been without insurance for more than 63 days?</p>
                                </div>
                            </div>
                        </div>
                        <div class="row row3">
                            <div class="col-xs-12">
                                <div class="input-group m-b">
                                    <span class="input-group-addon">Medication type</span>
                                    <select class="form-control" ng-model="lead.med_ty">
                                        <option ng-repeat="medty in [{name: ''},{name: 'Generic'},{name: 'Mostly Generic'},{name: 'Name Brand'},{name: 'Mostly Name Brand'}]" value="medty.name">{[{medty.name}]}</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row row3">
                            <div class="col-xs-12">
                                <div class="input-group m-b">
                                    <span class="input-group-addon">Dr. visits per year</span>
                                    <input type="number" class="form-control" ng-model="lead.dr_vis">
                                </div>
                            </div>
                        </div>
                        <div class="row row3">
                            <div class="col-xs-12">
                                <div class="input-group m-b">
                                    <span class="input-group-addon"><input type="checkbox" ng-model="lead.smoker"></span>
                                    <p class="form-control">Tobacco use</p>
                                </div>
                            </div>
                        </div>
                        <div class="row row3">
                            <div class="col-xs-12">
                                <div class="input-group m-b">
                                    <span class="input-group-addon"><input type="checkbox" ng-model="lead.de_in"></span>
                                    <p class="form-control">Denied insurance</p>
                                </div>
                            </div>
                        </div>
                        <div class="row row3">
                            <div class="col-xs-12">
                                <div class="input-group m-b">
                                    <span class="input-group-addon">Insurance aspects importance</span>
                                    <textarea class="form-control" ng-model="lead.ins_asp"></textarea>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="row" ng-show="setInfo == 3">

                        <div class="col-xs-6 b-r">
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.al_dr"></span>
                                <p class="form-control">Alcohol or Drug Abuse</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.alz"></span>
                                <p class="form-control">Alzheimer's Disease</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.art_d"></span>
                                <p class="form-control">Arterial Disease</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.bon_d"></span>
                                <p class="form-control">Bone Disease</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.emphy"></span>
                                <p class="form-control">Emphysema</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.fibro"></span>
                                <p class="form-control">Fibromyalgia</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.bip"></span>
                                <p class="form-control">Bipolar Disorder/ Manic Depression</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.acc_cer"></span>
                                <p class="form-control">Cerebrovascular Accident (CVA)</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.obs_lung"></span>
                                <p class="form-control">Chronic Obstructive Lung Disease (COLD)</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.obs_pul"></span>
                                <p class="form-control">Chronic Obstructive Pulmonary Disease (COPD)  or Cirrhosis</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.crohn_d"></span>
                                <p class="form-control">Crohn's Disease (ileitis)</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.hepp"></span>
                                <p class="form-control">Hepatitis</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.heart_att"></span>
                                <p class="form-control">Heart Attack,Heart Disease,Heart Surgery</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.ins_dep"></span>
                                <p class="form-control">Insulin Dependent Diabetes</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.int_ca"></span>
                                <p class="form-control">Internal Cancer</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.kidn_d"></span>
                                <p class="form-control">Kidney Disease</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.liv_d"></span>
                                <p class="form-control">Liver Disease</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.lou_d"></span>
                                <p class="form-control">Lou Gehrig's Disease (ALS)</p>
                            </div>
                        </div>
                        <div class="col-xs-6 b-r">
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.lupus"></span>
                                <p class="form-control">Lupus Erythematosus</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.depress"></span>
                                <p class="form-control">Major Depression</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.melo_ca"></span>
                                <p class="form-control">Melanoma Cancer</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.sclero"></span>
                                <p class="form-control">Multiple Sclerosis</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.muscle_d"></span>
                                <p class="form-control">Muscle Disease</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.muscle_dy"></span>
                                <p class="form-control">Muscular Dystrophy</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.myosi"></span>
                                <p class="form-control">Myositis</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.organ_f"></span>
                                <p class="form-control">Organ Failure</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.orga_t"></span>
                                <p class="form-control">Organ Transplant</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.brain_s"></span>
                                <p class="form-control">Organic Brain Syndrome</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.osteop"></span>
                                <p class="form-control">Osteoporosis w/ history of bone fracture</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.paraly"></span>
                                <p class="form-control">Paralysis (any type of degree)</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.isc_att"></span>
                                <p class="form-control">Transient Ischemic Attack (TIA)</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.peri_va"></span>
                                <p class="form-control">Peripheral Vascular Disease</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.rheu_ar"></span>
                                <p class="form-control">Rheumatoid Arthritis</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.seni_d"></span>
                                <p class="form-control">Senile Dementia</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.stroke"></span>
                                <p class="form-control">Stroke</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.sub_ad"></span>
                                <p class="form-control">Substance Abuse</p>
                            </div>
                            <div class="input-group m-b">
                                <span class="input-group-addon"><input type="checkbox" ng-model="lead.ulc"></span>
                                <p class="form-control">Ulcerative Colitis</p>
                            </div>
                        </div>
                </div>

                </div>
            </div>

            <div class="row" style="margin-top: 10px;">
                <div class="col-xs-12">
                    <div class="row">
                        <div class="col-xs-6 text-justify">
                            <span>Destination: &nbsp;&nbsp;&nbsp;</span>
                                <label class="radio-inline" ng-repeat="c in customers">
                                    <input type="radio" name="destinationRadios" ng-model="customer" ng-change="$parent.setCustomer({[{c.id}]})" />{[{c.code}]}
                                </label>
                        </div>

                        <div class="col-xs-6">
                            <div class="pull-right">
                                <button class="btn btn1 btn-sm btn-warning m-t-n-xs" ng-click="reloadData();"><strong>Reload</strong></button>
                                <button class="btn btn1 btn-sm btn-success m-t-n-xs" ng-disabled=" (btn_action == 'posting')" ng-click="emailData();"><strong>Email</strong></button>
                                <button class="btn btn1 btn-sm btn-primary m-t-n-xs" ng-disabled="submitted || leadBasicForm.$invalid || (btn_action == 'posting')" ng-click="saveLead()"><strong>Save</strong></button>
                                <button class="btn btn1 btn-sm btn-danger m-t-n-xs" ng-disabled="submitted || customer == 0 || leadBasicForm.$invalid  || (btn_action == 'posting')" ng-click="submitLead()"><strong>Submit</strong></button>
                            </div>
{#                            <p class="error alert-danger" ng-show="leadBasicForm.$invalid">{[{leadBasicForm.$error | json}]}</p>#}


                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container" ng-show="setInfo == 4">
            <p class="lead text-center bg-primary"><strong>Submitted lead information ...</strong></p>

            <div class="row row3">
                <div class="col-xs-4">
                    <span class="input-group-addon">Plan Size: <strong>{[{planOpts[lead.plan_size]}]}</strong></span>
                </div>
                <div class="col-xs-4">
                    <span class="input-group-addon">Budget: <strong>{[{lead.budget}]}</strong></span>
                </div>
                <div class="col-xs-4">
                    <span class="input-group-addon">Income: <strong>{[{lead.income}]}</strong></span>
                </div>
            </div>
            <div class="row row3">
                <div class="col-xs-4">
                    <span class="input-group-addon"  >First Name: <strong>{[{lead.first_name}]}</strong></span>
                </div>
                <div class="col-xs-4">
                    <span class="input-group-addon">Middle I: <strong>{[{lead.middle_initial}]}</strong></span>
                </div>
                <div class="col-xs-4">
                    <span class="input-group-addon">Last Name: <strong>{[{lead.last_name}]}</strong></span>
                </div>
            </div>
            <div class="row row3">
                <div class="col-xs-5">
                    <span class="input-group-addon">Phone: <strong>{[{lead.phone}]}</strong></span>
                </div>
                <div class="col-xs-7">
                    <span class="input-group-addon">Email: <strong>{[{lead.primary_email}]}</strong></span>
                </div>
            </div>
            <div class="row row3">
                <div class="col-xs-12">
                    <span class="input-group-addon">Address: <strong>{[{lead.address}]}</strong></span>
                </div>
            </div>
            <div class="row row3">
                <div class="col-xs-4">
                    <span class="input-group-addon">City: <strong>{[{lead.city}]}</strong></span>
                </div>
                <div class="col-xs-4">
                    <span class="input-group-addon">State: <strong>{[{lead.state}]}</strong></span>

                </div>
                <div class="col-xs-4">
                    <span class="input-group-addon">Zip Code: <strong>{[{lead.zipcode}]}</strong></span>
                </div>
            </div>
            <div class="row row3">
                <div class="col-xs-4">
                    <span class="input-group-addon">Height (ft): <strong>{[{lead.height_feet}]}</strong></span>
                </div>
                <div class="col-xs-4">
                    <span class="input-group-addon">Height (in): <strong>{[{lead.height_inches}]}</strong></span>
                </div>
                <div class="col-xs-4">
                    <span class="input-group-addon">Weight: <strong>{[{lead.weight}]}</strong></span>
                </div>
            </div>
            <div class="row row3">
                <div class="col-xs-12">
                    <span class="input-group-addon">Date of Birth (DOB): <strong>{[{selLeadDOB}]}</strong></span>
                </div>
            </div>
            <div class="row row3">
                <div class="col-xs-12">
                    <span class="input-group-addon">Conditions: <strong>{[{lead.conditions}]}</strong></span>
                </div>
            </div>
            <div class="row row3">
                <div class="col-xs-12">
                    <span class="input-group-addon">Number of medications: <strong>{[{lead.nu_med}]}</strong></span>

                </div>
            </div>
        </div>
    </div>

</div>

</body>
</html>
